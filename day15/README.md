#### [å›ç›®éŒ„](../README.md)
## Day15 json x çˆ¬èŸ² = ç‘£äº‹è‡ªå‹•åŒ–ï¼Œç”Ÿå‘½æ‡‰è©²æµªè²»åœ¨ç¾å¥½çš„äº‹æƒ…ä¸Š

>å³ä½¿å®¢æˆ¶ä¸æ‡‚ç¨‹å¼ï¼Œä½ ä¹Ÿå¯ä»¥è®“ä»–å­¸ç¿’ä¸€é»å·¥ç¨‹å¸«çš„çŸ¥è­˜

ğŸ¤” æˆ‘å€‘è¦è«‹å®¢æˆ¶å°‡çˆ¬èŸ²çš„ç¶²å€åˆ—è¡¨å¡«å¯«åˆ°ä»€éº¼æª”æ¡ˆå‘¢?
----
å°ˆæ¡ˆåœ¨éœ€æ±‚è¦æ ¼ä¸­æœ‰ä¸€æ¢æ˜¯`åœ¨è‡ªå·±çš„é›»è…¦åŸ·è¡Œ`ï¼Œåœ¨åˆ†æå®Œå„ç¨®æª”æ¡ˆæ ¼å¼çš„å„ªç¼ºé»å¾Œæˆ‘æ±ºå®šä½¿ç”¨jsonæ ¼å¼ï¼š
* **txt**
    * å„ªé»ï¼šåœ¨æ‰€æœ‰ä½œæ¥­ç³»çµ±ä¸­éƒ½èƒ½å¤ æ‰“é–‹åšç·¨è¼¯
    * ç¼ºé»ï¼š`æ ¼å¼é›£ä»¥å¾‹å®š`ï¼Œåªè¦ä½¿ç”¨è€…å¤šå€‹ç©ºæ ¼ã€è¡¨é»ç¬¦è™Ÿ...éƒ½å®¹æ˜“é€ æˆç¨‹å¼çš„èª¤åˆ¤
* **excel**
    * å„ªé»ï¼šé€™æ˜¯å°ä½¿ç”¨è€…è€Œè¨€æœ€å‹å–„çš„ä¸€ç¨®ç·¨è¼¯å™¨äº†ï¼Œè¦–è¦ºåŒ–è‰¯å¥½ã€æ“ä½œå‹å–„
    * ç¼ºé»ï¼š`ä¸æ˜¯æ‰€æœ‰äººé›»è…¦éƒ½æœ‰å®‰è£ excel` ç·¨è¼¯å™¨(åƒæˆ‘æœ‹å‹å°±æ²’æœ‰)
* **json**
    * å„ªé»ï¼šåœ¨æ‰€æœ‰ä½œæ¥­ç³»çµ±ä¸­éƒ½èƒ½å¤ æ‰“é–‹åšç·¨è¼¯ï¼Œ`key-value çš„æ ¼å¼æ˜“æ–¼ç†è§£ã€ç¨‹å¼å¯ç›´æ¥è®€å–`
    * ç¼ºé»ï¼šä½¿ç”¨è€…éœ€è¦èŠ±å¹¾åˆ†é˜æ™‚é–“ç†è§£ json æ ¼å¼çš„è¦å‰‡

----

ğŸ† ä»Šæ—¥ç›®æ¨™
----
### 1. äº†è§£jsonæ ¼å¼èˆ‡åŸºæœ¬è¦å‰‡ï¼Œä¸¦å»ºç«‹jsonæ ¼å¼çš„ç²‰å°ˆæ¸…å–®
1.1 jsonæ ¼å¼èˆ‡åŸºæœ¬è¦å‰‡
1.2 åœ¨å°ˆæ¡ˆä¸­å»ºç«‹jsonæ ¼å¼çš„ç²‰å°ˆæ¸…å–®

### 2. è®“ç¨‹å¼è®€å–jsonè£¡é¢çš„è³‡æ–™é€²è¡Œçˆ¬èŸ²
2.1 åœ¨å°ˆæ¡ˆå¼•å…¥jsonæª”æ¡ˆ
2.2 æ‰¹é‡çˆ¬èŸ²ç¨‹å¼æ’°å¯«

----

# 1. äº†è§£jsonæ ¼å¼èˆ‡åŸºæœ¬è¦å‰‡ï¼Œä¸¦å»ºç«‹ä¸€ä»½jsonæ ¼å¼çš„ç²‰å°ˆæ¸…å–®
ä»Šå¤©èªªçš„é€™å€‹éƒ¨åˆ†æ‡‰è©²æ˜¯å¤§éƒ¨åˆ†å°ç·¨æœ€é—œå¿ƒçš„ï¼Œè¦æ¯å¤©æ‰‹å‹•ç€è¦½é‚£éº¼å¤šçš„ç²‰å°ˆæƒ³æƒ³éƒ½å¾ˆå´©æ½°  
æ‰€ä»¥è¦ä¾†è·Ÿå¤§å®¶ä»‹ç´¹çš„ä¸€å€‹å¾ˆæ£’çš„æ–‡æœ¬æ ¼å¼ï¼š**json** (JavaScript Object Notation)ï¼Œ`ä»–èƒ½å¹«åŠ©æˆ‘å€‘æ‰¹é‡çˆ¬èŸ²ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ç¶²é apiæœ€å¸¸è¦‹çš„ä¸€ç¨®å›å‚³æ ¼å¼`  

### 1.1 jsonæ ¼å¼èˆ‡åŸºæœ¬è¦å‰‡
json å¯ä»¥åŒ…å« `object (ç‰©ä»¶)` èˆ‡ `array (é™£åˆ—)` 
* **ç‰©ä»¶**
    * ç‚º key-value çš„æ ¼å¼
        ```js
        { "key" : "value" }

        { "å§“å" : "å¯¶å¯¶ä¸èªª" } //é€šå¸¸ç”¨æ–¼æå¯«ä¸€é …å±¬æ€§çš„æ•¸å€¼
        ```
    * å¤šå€‹ç‰©ä»¶ä½¿ç”¨ , åšç‚ºåˆ†éš”
        ```js
        { "key" : "value" , "key" : "value" }

        { "å§“å" : "å¯¶å¯¶ä¸èªª" , "æ€§åˆ¥" : "ä¸æ˜" } //å¤šå€‹ç‰©ä»¶å¯è¡¨é”ä¸€å€‹æ±è¥¿çš„å¤šç¨®å±¬æ€§
        ```
* **é™£åˆ—**
    * å¤šå€‹ value ä¹‹é–“ä½¿ç”¨ , åˆ†éš”
        ```js
        [ value, value ]

        // é™£åˆ—èˆ‡ç‰©ä»¶è£¡é¢valueå¯ä»¥ä½¿ç”¨å¤šç¨®è³‡æ–™å‹æ…‹å¦‚ä¸‹
        [ 0 , { "å‚³å¥‡å¯¶å¯¶" : null } , "string" , false , ['test'] ]
        ```

### 1.2 åœ¨å°ˆæ¡ˆä¸­å»ºç«‹jsonæ ¼å¼çš„ç²‰å°ˆæ¸…å–®
**å»ºæ§‹é‚è¼¯ï¼š**
1. æˆ‘å€‘æœ‰`è¨±å¤šç²‰å°ˆéœ€è¦å»è¿½è¹¤`ï¼Œæ‰€ä»¥æœ€å¤–å±¤æœƒç”¨ `é™£åˆ—(array)`  
2. è€Œ`æ¯å€‹ç²‰å°ˆéƒ½æœ‰è‡ªå·±çš„å±¬æ€§`(titleç‚ºç²‰å°ˆåç¨±ã€urlç‚ºç²‰å°ˆç¶²å€)ï¼Œæ‰€ä»¥é™£åˆ—è£¡é¢çš„ value æ¡ç”¨ `ç‰©ä»¶(object)`  
    ```json
    [
        {
            "title": "ç²‰å°ˆA",
            "url": "ç²‰å°ˆAé€£çµ"
        },
        {
            "title": "ç²‰å°ˆB",
            "url": "ç²‰å°ˆBé€£çµ"
        }  
    ]
    ```
**åœ¨å°ˆæ¡ˆå»ºç«‹çš„æ­¥é©Ÿï¼š**
1. åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾ä¸­`å»ºç«‹ fanspages çš„è³‡æ–™å¤¾`ï¼Œå°ˆé–€å­˜æ”¾ç²‰å°ˆé é¢çˆ¬èŸ²è¦ä½¿ç”¨çš„jsonæª”æ¡ˆ
2. åœ¨ `fanspages è³‡æ–™å¤¾ä¸­æ–°å¢ ig.jsonã€fb.json` é€™å…©å€‹æª”æ¡ˆï¼Œä¸¦ä¾ç…§ä¸Šè¿°jsonçµæ§‹å¡«ä¸Šä½ è¦çˆ¬èŸ²çš„è³‡è¨Š  
3. ä½ å¯ä»¥å…ˆè¤‡è£½ä¸‹æ–¹ç¯„ä¾‹åšæ¸¬è©¦(ç­†è€…æ˜¯ä»¥ä¸‹è²¼åœ–çš„ç‹‚ç†±æ„›å¥½è€…ï¼Œæ­¡è¿ä¸€èµ·è¿½è¹¤æŒ‰æ„›å¿ƒXD)
#### ig.json
```json
[
    {
        "title": "å¯¶å¯¶ä¸èªª",
        "url": "https://www.instagram.com/baobaonevertell/"
    },
    {
        "title": "æ¾å°¼",
        "url": "https://www.instagram.com/sweethouse.sl/"
    },
    {
        "title": "éº»ç³¬çˆ¸",
        "url": "https://www.instagram.com/mochi_dad/"
    },
    {
        "title": "å¥½æƒ³å…”",
        "url": "https://www.instagram.com/chien_chien0608/"
    },
    {
        "title": "ã„‡ã„šËŠå¹¾å…”",
        "url": "https://www.instagram.com/machiko324/"
    }
]
```

----

# 2. è®“çˆ¬èŸ²ç¨‹å¼è®€å–jsonè£¡é¢çš„è³‡æ–™
### 2.1 åœ¨å°ˆæ¡ˆå¼•å…¥jsonæª”æ¡ˆ
* å¼•å…¥jsonæª”æ¡ˆæ™‚è«‹æ³¨æ„ç›¸å°è·¯å¾‘ï¼Œå»ºè­°å…ˆç”¨ `console.log` ç¢ºèªæ˜¯å¦æœ‰æ­£ç¢ºå¼•å…¥
* å› ç‚ºé€™å€‹æª”æ¡ˆæ˜¯äººå·¥æ’°å¯«ï¼Œå¯èƒ½æœƒä¸å°å¿ƒè¤‡è£½åˆ°é‡è¤‡ç²‰å°ˆï¼Œæ‰€ä»¥ä½¿ç”¨ä¾† `filteréæ¿¾`
```js
let fanpage_array = require('../fanspages/ig.json');
//éæ¿¾æ‰é‡è¤‡çš„ç²‰å°ˆé é¢ï¼Œæ¸›å°‘è³‡æºæµªè²»
fanpage_array = fanpage_array.filter((fanpage, index, self) =>
    index === self.findIndex(f => f.url === fanpage.url)
)
console.log(fanpage_array)
```

### 2.2 æ‰¹é‡çˆ¬èŸ²ç¨‹å¼æ’°å¯«
* å°‡å‰å¾€ç²‰å°ˆé é¢èˆ‡çˆ¬èŸ²çš„éƒ¨åˆ†ç”¨ `for/ofè¿´åœˆ` åŒ…èµ·ä¾†ï¼Œå› ç‚ºè¿´åœˆå…§æœ‰ç”¨åˆ°**async/await**ï¼Œè®“ä»–ä¾åºå‰å¾€ç²‰å°ˆé é¢æŠ“è³‡æ–™
    ```js
    for (fanpage of fanpage_array) {
        // æ’°å¯«ä½ è¦å°fanpageåšçš„äº‹       
    }
    ```
* æˆ‘å€‘è¦ç•¶å€‹å¥½çˆ¬èŸ²ï¼Œæ¯å€‹é é¢è¨­å®šçˆ¬èŸ²åœç•™3-6ç§’ï¼Œ`ä¸è¦å› ç‚ºè‡ªå·±çš„çˆ¬èŸ²é€ æˆåˆ¥äººä¼ºæœå™¨çš„è² æ“”`
    >é€™è£¡æˆ‘å€‘ä½¿ç”¨Math.random()å–å¾—å€é–“äº‚æ•¸
    ```js
    await driver.sleep((Math.floor(Math.random()*4)+3)*1000)
    ```
* çµ±æ•´å¾Œå®Œæ•´ç¨‹å¼å¦‚ä¸‹
    #### crawlerIG.js
    ```js
    let fanpage_array = require('../fanspages/ig.json');
    //éæ¿¾æ‰é‡è¤‡çš„ç²‰å°ˆé é¢ï¼Œæ¸›å°‘è³‡æºæµªè²»
    fanpage_array = fanpage_array.filter((fanpage, index, self) =>
        index === self.findIndex(f => f.url === fanpage.url)
    )
    const ig_username = process.env.IG_USERNAME
    const ig_userpass = process.env.IG_PASSWORD
    const { By, until } = require('selenium-webdriver') // å¾å¥—ä»¶ä¸­å–å‡ºéœ€è¦ç”¨åˆ°çš„åŠŸèƒ½
    exports.crawlerIG = crawlerIG;//è®“å…¶ä»–ç¨‹å¼åœ¨å¼•å…¥æ™‚å¯ä»¥ä½¿ç”¨é€™å€‹å‡½å¼

    async function crawlerIG (driver) {
        const isLogin = await loginInstagram(driver, By, until)
        if (isLogin) {//å¦‚æœç™»å…¥æˆåŠŸæ‰åŸ·è¡Œä¸‹é¢çš„å‹•ä½œ
            console.log(`IGé–‹å§‹çˆ¬èŸ²`)
            for (fanpage of fanpage_array) {
                let trace = null
                const isGoFansPage = await goFansPage(driver, fanpage.url)
                if (isGoFansPage) {
                    await driver.sleep((Math.floor(Math.random() * 4) + 3) * 1000)//æ¯å€‹é é¢çˆ¬èŸ²åœç•™3~6ç§’ï¼Œä¸è¦é€ æˆåˆ¥äººçš„ä¼ºæœå™¨è² æ“”
                    trace = await getTrace(driver, By, until)
                }
                if (trace === null) {
                    console.log(`${fanpage.title}ç„¡æ³•æŠ“å–è¿½è¹¤äººæ•¸`)
                } else {
                    console.log(`${fanpage.title}è¿½è¹¤äººæ•¸ï¼š${trace}`)
                }
                
            }
        }
    }
    .//å¾Œé¢ç¨‹å¼ä¸€æ¨£
    .
    .
    ```

ğŸš€ åŸ·è¡Œç¨‹å¼
----
åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾çš„çµ‚ç«¯æ©Ÿ(Terminal)åŸ·è¡ŒæŒ‡ä»¤
```vim
yarn start
```
ç•«é¢åŸ·è¡Œé †åºï¼šInstagramè‡ªå‹•ç™»å…¥ &rarr; ä¾åºè·³è½‰åˆ°æŒ‡å®šå¸³è™Ÿ &rarr; Facebookè‡ªå‹•ç™»å…¥ &rarr; ä¾åºè·³è½‰åˆ°ç²‰çµ²é  &rarr; é—œé–‰

å¤§æ¦‚è£å®Œä¸€å£ºæ°´çš„æ™‚é–“å¾Œï¼Œä½ å°±èƒ½çœ‹åˆ°FB & IGçš„è¿½è¹¤äººæ•¸åš•ï½  
![image](./article_img/terminal.png)  

æ­é…ä¸Šjsonå¾Œæœ‰æ²’æœ‰è¦ºå¾—è‡ªå·±åŠŸåŠ›å¤§å¢XDï¼Œä¸Šé¢çš„æ˜¯IGçš„ç¯„ä¾‹ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å˜—è©¦çœ‹çœ‹FBéƒ¨åˆ†çš„å¦‚ä½•æ”¹å¯«å–”ï½


â„¹ï¸ å°ˆæ¡ˆåŸå§‹ç¢¼
----
* ä»Šå¤©çš„å®Œæ•´ç¨‹å¼ç¢¼å¯ä»¥åœ¨[é€™è£¡](https://github.com/dean9703111/ithelp_30days/tree/master/day15)æ‰¾åˆ°å–”
* æˆ‘ä¹Ÿè²¼å¿ƒåœ°æŠŠæ˜¨å¤©çš„æŠŠæ˜¨å¤©çš„ç¨‹å¼ç¢¼æ‰“åŒ…æˆ[å£“ç¸®æª”](https://github.com/dean9703111/ithelp_30days/raw/master/sampleCode/day14_sample_code.zip)ï¼Œä½ å¯ä»¥ç”¨è£¡é¢ä¹¾æ·¨çš„ç’°å¢ƒä¾†å¯¦ä½œä»Šå¤©jsonæ”¹å¯«çš„éƒ¨åˆ†å–”
    * è«‹è¨˜å¾—åœ¨çµ‚ç«¯æ©Ÿä¸‹æŒ‡ä»¤ **yarn** æ‰æœƒæŠŠä¹‹å‰çš„å¥—ä»¶å®‰è£
    * windowséœ€ä¸‹è¼‰èˆ‡ä½ chromeç‰ˆæœ¬ç›¸åŒçš„[chrome driver](http://chromedriver.storage.googleapis.com/index.html)æ”¾åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„
    * èª¿æ•´.envæª”
        * å¡«ä¸ŠFBç™»å…¥è³‡è¨Š
        * å¡«ä¸ŠFBç‰ˆæœ¬(classic/new)
        * å¡«ä¸ŠIGç™»å…¥è³‡è¨Š
    * èª¿æ•´fanspagesè³‡æ–™å¤¾å…§ç›®æ¨™çˆ¬èŸ²çš„ç²‰å°ˆç¶²å€

ğŸ“–åƒè€ƒè³‡æº
----
1. [JSON æ ¼å¼èˆ‡ JavaScript è§£ææ•™å­¸ç¯„ä¾‹](https://www.footmark.info/programming-language/javascript/json-format-and-javascript/)
2. [ç”¨Math.random()å–å¾—äº‚æ•¸çš„æŠ€å·§](https://ithelp.ithome.com.tw/articles/10197904)
<br>

>*å…è²¬è²æ˜:æ–‡ç« æŠ€è¡“åƒ…æŠ“å–å…¬é–‹æ•¸æ“šä½œçˆ²ç ”ç©¶ï¼Œä»»ä½•çµ„ç¹”å’Œå€‹äººä¸å¾—ä»¥æ­¤æŠ€è¡“ç›œå–ä»–äººæ™ºæ…§è²¡ç”¢ã€é€ æˆç¶²ç«™æå®³ï¼Œå¦å‰‡ä¸€åˆ‡åæœç”±è©²çµ„ç¹”æˆ–å€‹äººæ‰¿æ“”ã€‚ä½œè€…ä¸æ‰¿æ“”ä»»ä½•æ³•å¾‹åŠé€£å¸¶è²¬ä»»ï¼*
### [Day16 ä¸è—ç§ï¼ŒåŠ ä¸Š5è¡Œç¨‹å¼å°±èƒ½å„ªåŒ–çˆ¬èŸ²çš„å°æŠ€å·§ ï¼† å­¸æœƒçˆ¬èŸ²ï¼Œä¹‹å¾Œå‘¢ï¼Ÿ](/day16/README.md)